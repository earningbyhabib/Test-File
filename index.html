<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ফেসবুক ভেরিফিকেশন মেইল</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    #email {
      font-weight: bold;
      word-break: break-all;
      margin: 10px 0;
    }
    button {
      padding: 8px 15px;
      margin: 5px;
      cursor: pointer;
    }
    .message {
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px 0;
    }
    .fb-code {
      color: green;
      font-weight: bold;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h2>ফেসবুক ভেরিফিকেশন মেইল</h2>
  <div id="email">ইমেইল তৈরি করা হচ্ছে...</div>
  <button onclick="copyEmail()">ইমেইল কপি করুন</button>
  <button onclick="generateEmail()">নতুন ইমেইল তৈরি করুন</button>
  
  <h3>ইনবক্স</h3>
  <div id="inbox">মেইল চেক করা হচ্ছে...</div>

  <script>
    let currentEmail = '';
    let mailId = '';

    async function generateEmail() {
      try {
        // নতুন ইমেইল জেনারেট
        const response = await fetch('https://api.internal.temp-mail.io/api/v3/email/new', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            min_name_length: 10,
            max_name_length: 10
          })
        });
        
        const data = await response.json();
        currentEmail = data.email;
        mailId = data.token;
        document.getElementById('email').textContent = currentEmail;
        document.getElementById('inbox').textContent = 'মেইল চেক করা হচ্ছে...';
        
        // প্রতি 5 সেকেন্ডে মেইল চেক
        checkMail();
        setInterval(checkMail, 5000);
        
      } catch(error) {
        document.getElementById('email').textContent = 'ত্রুটি: ' + error.message;
      }
    }

    async function checkMail() {
      try {
        const response = await fetch(`https://api.internal.temp-mail.io/api/v3/email/${mailId}/messages`);
        const messages = await response.json();
        
        let inboxHTML = '';
        
        if(messages.length > 0) {
          messages.forEach(msg => {
            let messageContent = msg.body_text || msg.subject || 'কোনো টেক্সট নেই';
            
            inboxHTML += `
              <div class="message">
                <strong>থেকে:</strong> ${msg.from}<br>
                <strong>বিষয়:</strong> ${msg.subject}<br>
                <div>${messageContent}</div>
            `;
            
            // ফেসবুক কোড খুঁজে বের করা
            if(msg.from.includes('facebook') || msg.subject.includes('Facebook')) {
              const code = extractFacebookCode(messageContent);
              if(code) {
                inboxHTML += `<div class="fb-code">ফেসবুক ভেরিফিকেশন কোড: ${code}</div>`;
              }
            }
            
            inboxHTML += `</div>`;
          });
        } else {
          inboxHTML = 'কোনো মেইল পাওয়া যায়নি';
        }
        
        document.getElementById('inbox').innerHTML = inboxHTML;
      } catch(error) {
        console.error('মেইল চেক করতে ব্যর্থ:', error);
      }
    }

    function extractFacebookCode(text) {
      // ফেসবুক কোড এক্সট্র্যাক্ট (5-8 ডিজিটের কোড)
      const codeMatch = text.match(/\b\d{5,8}\b/);
      return codeMatch ? codeMatch[0] : null;
    }

    function copyEmail() {
      navigator.clipboard.writeText(currentEmail);
      alert('ইমেইল কপি করা হয়েছে!');
    }

    // পেজ লোড হওয়ার সাথে সাথে ইমেইল তৈরি
    window.onload = generateEmail;
  </script>
</body>
</html>
